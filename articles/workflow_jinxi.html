<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow: Jinxi • urbanAnnualRunoff</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Workflow: Jinxi">
<meta property="og:description" content="urbanAnnualRunoff">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">urbanAnnualRunoff</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workflow_beijing.html">Workflow: Beijing</a>
    </li>
    <li>
      <a href="../articles/workflow_jinxi.html">Workflow: Jinxi</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KWB-R/urbanAnnualRunoff/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workflow_jinxi_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workflow: Jinxi</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/urbanAnnualRunoff/blob/master/vignettes/workflow_jinxi.Rmd"><code>vignettes/workflow_jinxi.Rmd</code></a></small>
      <div class="hidden name"><code>workflow_jinxi.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">### prerequisites (64bit R)</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="cf">if</span>(<span class="kw">Sys.getenv</span>(<span class="st">"R_ARCH"</span>) <span class="op">!=</span><span class="st"> "/x64"</span>) {</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="kw">stop</span>(<span class="st">"Spatial operations need a lot of RAM. Use of 64bit R is required. </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="st">  </span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="st">Workflow in RStudio:  </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="st">1. Go to 'Tools' (top pane)</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">2. Select 'Global Options' </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">3. Select 'General' </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">4. Under 'R Sessions' select 'Change' </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="st">5. Select 'Use the machine`s default R version of R64 (64-bit)'</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="st">6. Close all R Studio sessions  </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="st">7. Restart R Studio"</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>)</span>
<span id="cb1-14"><a href="#cb1-14"></a>} <span class="cf">else</span> {</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>path_list &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="dt">root_path =</span> <span class="st">"C:/kwb/projects/keys/Data-Work packages"</span>,</span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="dt">site =</span> <span class="st">"Jinxi"</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="dt">data =</span> <span class="st">"WP2_SUW_pollution_&lt;site&gt;"</span>,</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="dt">abimo =</span> <span class="st">"&lt;root_path&gt;/&lt;data&gt;/_DataAnalysis/abimo"</span>,</span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="dt">abimo_exe =</span> <span class="st">"&lt;abimo&gt;/Abimo3_2.exe"</span>,</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="dt">gis =</span> <span class="st">"&lt;root_path&gt;/&lt;data&gt;/_DataAnalysis/gis"</span>,</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="dt">climate =</span> <span class="st">"&lt;root_path&gt;/&lt;data&gt;/_DataAnalysis/climate"</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="dt">emissions_input =</span> <span class="st">"&lt;root_path&gt;/&lt;data&gt;/_DataAnalysis/emissions/input/annual_mean_conc.csv"</span>,</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="dt">emissions_output =</span> <span class="st">"&lt;root_path&gt;/&lt;data&gt;/_DataAnalysis/emissions/output"</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>)</span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a>paths &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">resolve</span>(path_list)</span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co"># load shapefile containing subcatchments ('blockteilflächen')</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>abimo &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">shapefile</span>(<span class="kw">file.path</span>(paths<span class="op">$</span>gis, <span class="st">'input_subareas.shp'</span>))</span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co"># make ABIMO 'CODE' column</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="kw">names</span>(abimo<span class="op">@</span>data) &lt;-<span class="st"> "CODE"</span> </span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co"># pad CODE with zeroes to match output of ABIMO</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>abimo<span class="op">@</span>data<span class="op">$</span>CODE &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">padCODE</span>(abimo<span class="op">@</span>data<span class="op">$</span>CODE)</span>
<span id="cb1-39"><a href="#cb1-39"></a></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co"># build classification model</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>kwb.ml<span class="op">::</span><span class="kw">buildClassMod</span>(</span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="dt">image =</span> <span class="st">'input_image.img'</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="dt">groundTruth =</span> <span class="st">'input_groundtruth.shp'</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>  <span class="dt">groundTruthValues =</span> <span class="kw">list</span>(<span class="st">'roof'</span> =<span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb1-46"><a href="#cb1-46"></a>                           <span class="st">'street'</span> =<span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb1-47"><a href="#cb1-47"></a>                           <span class="st">'pervious'</span> =<span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb1-48"><a href="#cb1-48"></a>                           <span class="st">'shadow'</span> =<span class="st"> </span><span class="dv">4</span>,</span>
<span id="cb1-49"><a href="#cb1-49"></a>                           <span class="st">'water'</span> =<span class="st"> </span><span class="dv">5</span>),</span>
<span id="cb1-50"><a href="#cb1-50"></a>  <span class="dt">spectrSigName =</span> <span class="st">'spectrSig.Rdata'</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="dt">modelName =</span> <span class="st">'rForest.Rdata'</span>,</span>
<span id="cb1-52"><a href="#cb1-52"></a>  <span class="dt">overlayExists =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="dt">nCores =</span> parallel<span class="op">::</span><span class="kw">detectCores</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="dt">mtryGrd =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, </span>
<span id="cb1-55"><a href="#cb1-55"></a>  <span class="dt">ntreeGrd=</span><span class="kw">seq</span>(<span class="dv">80</span>, <span class="dv">150</span>, <span class="dt">by=</span><span class="dv">10</span>),</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="dt">nfolds =</span> <span class="dv">3</span>, </span>
<span id="cb1-57"><a href="#cb1-57"></a>  <span class="dt">nodesize =</span> <span class="dv">3</span>, </span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="dt">cvrepeats =</span> <span class="dv">2</span>)</span>
<span id="cb1-59"><a href="#cb1-59"></a></span>
<span id="cb1-60"><a href="#cb1-60"></a><span class="co"># check model performance</span></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="kw">load</span>(<span class="kw">file.path</span>(paths<span class="op">$</span>gis,<span class="st">"rForest.Rdata"</span>))</span>
<span id="cb1-62"><a href="#cb1-62"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(<span class="dt">data =</span> model<span class="op">$</span>finalModel<span class="op">$</span>predicted, </span>
<span id="cb1-63"><a href="#cb1-63"></a>                       <span class="dt">reference =</span> model<span class="op">$</span>trainingData<span class="op">$</span>.outcome, </span>
<span id="cb1-64"><a href="#cb1-64"></a>                       <span class="dt">mode =</span> <span class="st">'prec_recall'</span>)</span>
<span id="cb1-65"><a href="#cb1-65"></a>                       </span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="co"># classify image for roofs and streets</span></span>
<span id="cb1-67"><a href="#cb1-67"></a>kwb.ml<span class="op">::</span><span class="kw">predictSurfClass</span>(<span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-68"><a href="#cb1-68"></a>                                    <span class="dt">modelName =</span> <span class="st">'rForest.Rdata'</span>,</span>
<span id="cb1-69"><a href="#cb1-69"></a>                                    <span class="dt">image =</span> <span class="st">'input_image.img'</span>,</span>
<span id="cb1-70"><a href="#cb1-70"></a>                                    <span class="dt">predName =</span> <span class="st">'classified_image.img'</span>)</span>
<span id="cb1-71"><a href="#cb1-71"></a></span>
<span id="cb1-72"><a href="#cb1-72"></a><span class="co"># make overlay object (list where each element is a vector of the pixel values </span></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co"># of the classified image for each subcatchment)</span></span>
<span id="cb1-74"><a href="#cb1-74"></a>urbanAnnualRunoff<span class="op">::</span><span class="kw">makeOverlay</span>(<span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-75"><a href="#cb1-75"></a>                               <span class="dt">rasterData =</span> <span class="st">'classified_image.img'</span>,</span>
<span id="cb1-76"><a href="#cb1-76"></a>                               <span class="dt">subcatchmSPobject =</span> abimo,</span>
<span id="cb1-77"><a href="#cb1-77"></a>                               <span class="dt">overlayName =</span> <span class="st">'surfType'</span>)</span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="co"># make ABIMO variable FLGES</span></span>
<span id="cb1-79"><a href="#cb1-79"></a>abimo<span class="op">@</span>data<span class="op">$</span>FLGES &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">makeFLGES</span>(<span class="dt">subcatchmSPobject =</span> abimo)</span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="co"># compute ABIMO variable PROBAU (%roof)</span></span>
<span id="cb1-82"><a href="#cb1-82"></a>abimo<span class="op">@</span>data<span class="op">$</span>PROBAU &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">makePROBAU</span>(</span>
<span id="cb1-83"><a href="#cb1-83"></a>  <span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-84"><a href="#cb1-84"></a>  <span class="dt">rasterData =</span> <span class="st">'classified_image.img'</span>,</span>
<span id="cb1-85"><a href="#cb1-85"></a>  <span class="dt">overlayName =</span> <span class="st">'surfType'</span>,</span>
<span id="cb1-86"><a href="#cb1-86"></a>  <span class="dt">targetValue =</span> <span class="dv">1</span>)</span>
<span id="cb1-87"><a href="#cb1-87"></a>  </span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="co"># compute ABIMO variable STR_FLGES (m2 street area)</span></span>
<span id="cb1-89"><a href="#cb1-89"></a>abimo<span class="op">@</span>data<span class="op">$</span>STR_FLGES &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">makeSTR_FLGES</span>(</span>
<span id="cb1-90"><a href="#cb1-90"></a>  <span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-91"><a href="#cb1-91"></a>  <span class="dt">subcatchmSPobject =</span> abimo,</span>
<span id="cb1-92"><a href="#cb1-92"></a>  <span class="dt">mask =</span> <span class="st">'input_maskUrbanCore.shp'</span>,</span>
<span id="cb1-93"><a href="#cb1-93"></a>  <span class="dt">rasterData =</span> <span class="st">'classified_image.img'</span>,</span>
<span id="cb1-94"><a href="#cb1-94"></a>  <span class="dt">overlayName =</span> <span class="st">'surfType'</span>,</span>
<span id="cb1-95"><a href="#cb1-95"></a>  <span class="dt">targetValue =</span> <span class="dv">2</span>)</span>
<span id="cb1-96"><a href="#cb1-96"></a></span>
<span id="cb1-97"><a href="#cb1-97"></a><span class="co"># compute ABIMO variable VG (% soil sealing)</span></span>
<span id="cb1-98"><a href="#cb1-98"></a>abimo<span class="op">@</span>data<span class="op">$</span>VG &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">makeVG</span>(</span>
<span id="cb1-99"><a href="#cb1-99"></a>  <span class="dt">rawdir =</span> paths<span class="op">$</span>gis,</span>
<span id="cb1-100"><a href="#cb1-100"></a>  <span class="dt">subcatchmSPobject =</span> abimo,</span>
<span id="cb1-101"><a href="#cb1-101"></a>  <span class="dt">rasterData =</span> <span class="st">'input_impervious.tif'</span>,</span>
<span id="cb1-102"><a href="#cb1-102"></a>  <span class="dt">targetValue =</span> <span class="dv">80</span>)</span>
<span id="cb1-103"><a href="#cb1-103"></a></span>
<span id="cb1-104"><a href="#cb1-104"></a><span class="co"># compute annual and summer rainfall. </span></span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="co"># *** potential enhancement: ***</span></span>
<span id="cb1-106"><a href="#cb1-106"></a><span class="co"># return the multiannual average annual rainfall. care must be taken to exclude</span></span>
<span id="cb1-107"><a href="#cb1-107"></a><span class="co"># incomplete years from the average calculation. same for summer rainfall</span></span>
<span id="cb1-108"><a href="#cb1-108"></a>precipitation &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">computeABIMOclimate</span>(</span>
<span id="cb1-109"><a href="#cb1-109"></a>  <span class="dt">rawdir =</span> paths<span class="op">$</span>climate,</span>
<span id="cb1-110"><a href="#cb1-110"></a>  <span class="dt">fileName =</span> <span class="kw">sprintf</span>(<span class="st">'raw_climateeng_precipitation_daily_%s.txt'</span>, </span>
<span id="cb1-111"><a href="#cb1-111"></a>                     paths<span class="op">$</span>site),</span>
<span id="cb1-112"><a href="#cb1-112"></a>  <span class="dt">skip =</span> <span class="dv">6</span>, <span class="dt">sep =</span> <span class="st">''</span>, <span class="dt">dec =</span> <span class="st">'.'</span>,</span>
<span id="cb1-113"><a href="#cb1-113"></a>  <span class="dt">outAnnual =</span> <span class="st">'precipitation_annual.txt'</span>,</span>
<span id="cb1-114"><a href="#cb1-114"></a>  <span class="dt">outSummer =</span><span class="st">'precipitation_summer.txt'</span>)</span>
<span id="cb1-115"><a href="#cb1-115"></a><span class="co"># compute annual and summer ETP. this goes manually into the ABIMO config file</span></span>
<span id="cb1-116"><a href="#cb1-116"></a>  evapotranspiration &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">computeABIMOclimate</span>(<span class="dt">rawdir =</span> paths<span class="op">$</span>climate,</span>
<span id="cb1-117"><a href="#cb1-117"></a>                    <span class="dt">fileName =</span> <span class="kw">sprintf</span>(<span class="st">'raw_climateeng_etp_daily_%s.txt'</span>, </span>
<span id="cb1-118"><a href="#cb1-118"></a>                                       paths<span class="op">$</span>site),</span>
<span id="cb1-119"><a href="#cb1-119"></a>                    <span class="dt">skip =</span> <span class="dv">6</span>, <span class="dt">sep =</span> <span class="st">''</span>, <span class="dt">dec =</span> <span class="st">'.'</span>,</span>
<span id="cb1-120"><a href="#cb1-120"></a>                    <span class="dt">outAnnual =</span> <span class="st">'etp_annual.txt'</span>,</span>
<span id="cb1-121"><a href="#cb1-121"></a>                    <span class="dt">outSummer =</span> <span class="st">'etp_summer.txt'</span>)</span>
<span id="cb1-122"><a href="#cb1-122"></a></span>
<span id="cb1-123"><a href="#cb1-123"></a><span class="co"># use raw code to compute and assign remaining ABIMO variables manually</span></span>
<span id="cb1-124"><a href="#cb1-124"></a><span class="co"># raw code ------------------------------------------------------------------------------</span></span>
<span id="cb1-125"><a href="#cb1-125"></a></span>
<span id="cb1-126"><a href="#cb1-126"></a><span class="co"># raw code ------------------------------------------------------------------------------</span></span>
<span id="cb1-127"><a href="#cb1-127"></a></span>
<span id="cb1-128"><a href="#cb1-128"></a><span class="co"># compute ABIMO variable PROVGU (% other impervious areas) as </span></span>
<span id="cb1-129"><a href="#cb1-129"></a><span class="co"># PROVGU = VG - PROBAU, setting any negative values to 0. this</span></span>
<span id="cb1-130"><a href="#cb1-130"></a><span class="co"># happens for only &lt;10% of subcatchments, and results mainly from</span></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="co"># differences in spatial resolution and classification differences</span></span>
<span id="cb1-132"><a href="#cb1-132"></a><span class="co"># between both datasets (our classified image and the global land </span></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="co"># use dataset)</span></span>
<span id="cb1-134"><a href="#cb1-134"></a>abimo<span class="op">@</span>data<span class="op">$</span>PROVGU &lt;-<span class="st"> </span><span class="kw">ifelse</span>((abimo<span class="op">@</span>data<span class="op">$</span>VG <span class="op">-</span><span class="st"> </span>abimo<span class="op">@</span>data<span class="op">$</span>PROBAU) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb1-135"><a href="#cb1-135"></a>                            abimo<span class="op">@</span>data<span class="op">$</span>VG <span class="op">-</span><span class="st"> </span>abimo<span class="op">@</span>data<span class="op">$</span>PROBAU,</span>
<span id="cb1-136"><a href="#cb1-136"></a>                            <span class="dv">0</span>)</span>
<span id="cb1-137"><a href="#cb1-137"></a></span>
<span id="cb1-138"><a href="#cb1-138"></a><span class="co"># % imperviousness streets</span></span>
<span id="cb1-139"><a href="#cb1-139"></a>abimo<span class="op">@</span>data<span class="op">$</span>VGSTRASSE &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-140"><a href="#cb1-140"></a></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="co"># %cover types in other imperv. areas (PROVGU)</span></span>
<span id="cb1-142"><a href="#cb1-142"></a>abimo<span class="op">@</span>data<span class="op">$</span>BELAG1 &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-143"><a href="#cb1-143"></a>abimo<span class="op">@</span>data<span class="op">$</span>BELAG2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-144"><a href="#cb1-144"></a>abimo<span class="op">@</span>data<span class="op">$</span>BELAG3 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-145"><a href="#cb1-145"></a>abimo<span class="op">@</span>data<span class="op">$</span>BELAG4 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-146"><a href="#cb1-146"></a></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="co"># %cover types in street areas</span></span>
<span id="cb1-148"><a href="#cb1-148"></a>abimo<span class="op">@</span>data<span class="op">$</span>STR_BELAG1 &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-149"><a href="#cb1-149"></a>abimo<span class="op">@</span>data<span class="op">$</span>STR_BELAG2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-150"><a href="#cb1-150"></a>abimo<span class="op">@</span>data<span class="op">$</span>STR_BELAG3 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-151"><a href="#cb1-151"></a>abimo<span class="op">@</span>data<span class="op">$</span>STR_BELAG4 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1-152"><a href="#cb1-152"></a></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="co"># identifiers</span></span>
<span id="cb1-154"><a href="#cb1-154"></a>abimo<span class="op">@</span>data<span class="op">$</span>BEZIRK &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-155"><a href="#cb1-155"></a>abimo<span class="op">@</span>data<span class="op">$</span>STAGEB &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-156"><a href="#cb1-156"></a>abimo<span class="op">@</span>data<span class="op">$</span>BLOCK &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-157"><a href="#cb1-157"></a>abimo<span class="op">@</span>data<span class="op">$</span>TEILBLOCK &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-158"><a href="#cb1-158"></a>abimo<span class="op">@</span>data<span class="op">$</span>NUTZUNG &lt;-<span class="st"> </span><span class="dv">21</span></span>
<span id="cb1-159"><a href="#cb1-159"></a>abimo<span class="op">@</span>data<span class="op">$</span>TYP &lt;-<span class="st"> </span><span class="dv">21</span></span>
<span id="cb1-160"><a href="#cb1-160"></a></span>
<span id="cb1-161"><a href="#cb1-161"></a></span>
<span id="cb1-162"><a href="#cb1-162"></a><span class="co"># annual rainfall (this can be automatized by making 'computeABIMOclimate'</span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="co"># return the multiannual average annual rainfall. care must be taken to exclude</span></span>
<span id="cb1-164"><a href="#cb1-164"></a><span class="co"># incomplete years from the average calculation)</span></span>
<span id="cb1-165"><a href="#cb1-165"></a></span>
<span id="cb1-166"><a href="#cb1-166"></a><span class="co"># manually averaged annual rainfall and summer rainfall</span></span>
<span id="cb1-167"><a href="#cb1-167"></a>abimo<span class="op">@</span>data<span class="op">$</span>REGENJA &lt;-<span class="st"> </span><span class="dv">1744</span> <span class="co"># averaged manually</span></span>
<span id="cb1-168"><a href="#cb1-168"></a>abimo<span class="op">@</span>data<span class="op">$</span>REGENSO &lt;-<span class="st"> </span><span class="dv">1258</span> <span class="co"># averaged manually</span></span>
<span id="cb1-169"><a href="#cb1-169"></a>  </span>
<span id="cb1-170"><a href="#cb1-170"></a><span class="co"># better version using dplyr</span></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="co">#year_min &lt;- 2015</span></span>
<span id="cb1-172"><a href="#cb1-172"></a><span class="co">#year_max &lt;- 2019</span></span>
<span id="cb1-173"><a href="#cb1-173"></a><span class="co">#abimo@data$REGENJA &lt;- precipitation$total %&gt;% </span></span>
<span id="cb1-174"><a href="#cb1-174"></a><span class="co">#  dplyr::filter(.data$year &gt;= year_min &amp; .data$year &lt;= year_max) %&gt;% </span></span>
<span id="cb1-175"><a href="#cb1-175"></a><span class="co">#  dplyr::summarise(value_mean = mean(.data$value)) %&gt;% </span></span>
<span id="cb1-176"><a href="#cb1-176"></a><span class="co">#  dplyr::pull()</span></span>
<span id="cb1-177"><a href="#cb1-177"></a><span class="co">#abimo@data$REGENSO &lt;- precipitation$summer %&gt;% </span></span>
<span id="cb1-178"><a href="#cb1-178"></a><span class="co">#  dplyr::filter(.data$year &gt;= year_min &amp; .data$year &lt;= year_max) %&gt;% </span></span>
<span id="cb1-179"><a href="#cb1-179"></a><span class="co">#  dplyr::summarise(value_mean = mean(.data$value)) %&gt;%  </span></span>
<span id="cb1-180"><a href="#cb1-180"></a><span class="co">#  dplyr::pull()</span></span>
<span id="cb1-181"><a href="#cb1-181"></a></span>
<span id="cb1-182"><a href="#cb1-182"></a><span class="co">### calculate mean evapotranspiration (total, summer) to be defined as input </span></span>
<span id="cb1-183"><a href="#cb1-183"></a><span class="co">### in ABIMO "config.xml" file</span></span>
<span id="cb1-184"><a href="#cb1-184"></a><span class="co"># ept_mean &lt;- tibble::tibble(total = evapotranspiration$total %&gt;% </span></span>
<span id="cb1-185"><a href="#cb1-185"></a><span class="co">#   dplyr::filter(.data$year &gt;= year_min &amp; .data$year &lt;= year_max) %&gt;% </span></span>
<span id="cb1-186"><a href="#cb1-186"></a><span class="co">#   dplyr::summarise(value_mean = mean(value)) %&gt;% </span></span>
<span id="cb1-187"><a href="#cb1-187"></a><span class="co">#   as.numeric(), </span></span>
<span id="cb1-188"><a href="#cb1-188"></a><span class="co">#   summer = evapotranspiration$summer %&gt;% </span></span>
<span id="cb1-189"><a href="#cb1-189"></a><span class="co">#   dplyr::filter(.data$year &gt;= year_min &amp; .data$year &lt;= year_max) %&gt;% </span></span>
<span id="cb1-190"><a href="#cb1-190"></a><span class="co">#   dplyr::summarise(value_mean = mean(.data$value)) %&gt;% </span></span>
<span id="cb1-191"><a href="#cb1-191"></a><span class="co">#   as.numeric())</span></span>
<span id="cb1-192"><a href="#cb1-192"></a><span class="co">#   </span></span>
<span id="cb1-193"><a href="#cb1-193"></a><span class="co">#   </span></span>
<span id="cb1-194"><a href="#cb1-194"></a><span class="co"># abimo_config &lt;- file.path(paths$abimo, "config.xml")</span></span>
<span id="cb1-195"><a href="#cb1-195"></a><span class="co"># </span></span>
<span id="cb1-196"><a href="#cb1-196"></a><span class="co"># message(sprintf("Manually set values in ABIMO config file:</span></span>
<span id="cb1-197"><a href="#cb1-197"></a><span class="co"># '%s'</span></span>
<span id="cb1-198"><a href="#cb1-198"></a><span class="co"># </span></span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="co"># In '&lt;section name=\"PotentielleVerdunstung\"&gt;\"' </span></span>
<span id="cb1-200"><a href="#cb1-200"></a><span class="co"># </span></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="co"># Enter the following values for for 'BEZIRK = 1' and also default 'BEZIRK = 0'</span></span>
<span id="cb1-202"><a href="#cb1-202"></a><span class="co"># etp: %4.0f</span></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="co"># etps: %4.1f",</span></span>
<span id="cb1-204"><a href="#cb1-204"></a><span class="co">#                 abimo_config,</span></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="co">#                 ept_mean$total, </span></span>
<span id="cb1-206"><a href="#cb1-206"></a><span class="co">#                 ept_mean$summer))</span></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="co"># </span><span class="al">###</span><span class="co"> open ABIMO config for manual data input</span></span>
<span id="cb1-208"><a href="#cb1-208"></a><span class="co"># kwb.utils::hsOpenWindowsExplorer(abimo_config)</span></span>
<span id="cb1-209"><a href="#cb1-209"></a></span>
<span id="cb1-210"><a href="#cb1-210"></a>  </span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="co">#abimo_config &lt;- file.path(paths$abimo, "config.xml")</span></span>
<span id="cb1-212"><a href="#cb1-212"></a></span>
<span id="cb1-213"><a href="#cb1-213"></a><span class="co">#message(sprintf("Manually set values in ABIMO config file:</span></span>
<span id="cb1-214"><a href="#cb1-214"></a><span class="st">'%s'</span></span>
<span id="cb1-215"><a href="#cb1-215"></a></span>
<span id="cb1-216"><a href="#cb1-216"></a><span class="co">#In '&lt;section name=\"PotentielleVerdunstung\"&gt;\"' </span></span>
<span id="cb1-217"><a href="#cb1-217"></a></span>
<span id="cb1-218"><a href="#cb1-218"></a><span class="co">#Enter the following values for for 'BEZIRK = 1' and also default 'BEZIRK = 0'</span></span>
<span id="cb1-219"><a href="#cb1-219"></a><span class="co">#etp: %4.0f</span></span>
<span id="cb1-220"><a href="#cb1-220"></a><span class="co">#etps: %4.1f",</span></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="co">#                abimo_config,</span></span>
<span id="cb1-222"><a href="#cb1-222"></a><span class="co">#                ept_mean$total, </span></span>
<span id="cb1-223"><a href="#cb1-223"></a><span class="co">#                ept_mean$summer))</span></span>
<span id="cb1-224"><a href="#cb1-224"></a><span class="co">### open ABIMO config for manual data input</span></span>
<span id="cb1-225"><a href="#cb1-225"></a><span class="co">#kwb.utils::hsOpenWindowsExplorer(abimo_config)</span></span>
<span id="cb1-226"><a href="#cb1-226"></a></span>
<span id="cb1-227"><a href="#cb1-227"></a><span class="co"># channelization degrees. these are set manually since there is no data</span></span>
<span id="cb1-228"><a href="#cb1-228"></a>abimo<span class="op">@</span>data<span class="op">$</span>KANAL&lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-229"><a href="#cb1-229"></a>abimo<span class="op">@</span>data<span class="op">$</span>KAN_BEB&lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-230"><a href="#cb1-230"></a>abimo<span class="op">@</span>data<span class="op">$</span>KAN_VGU&lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-231"><a href="#cb1-231"></a>abimo<span class="op">@</span>data<span class="op">$</span>KAN_STR&lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-232"><a href="#cb1-232"></a></span>
<span id="cb1-233"><a href="#cb1-233"></a><span class="co"># soil field capacity and groundwater level (personal communication, Dr. Lipin Li, </span></span>
<span id="cb1-234"><a href="#cb1-234"></a><span class="co"># Harbin Inst. of Technology)</span></span>
<span id="cb1-235"><a href="#cb1-235"></a>abimo<span class="op">@</span>data<span class="op">$</span>FELD_<span class="dv">30</span> &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb1-236"><a href="#cb1-236"></a>abimo<span class="op">@</span>data<span class="op">$</span>FELD_<span class="dv">150</span> &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb1-237"><a href="#cb1-237"></a>abimo<span class="op">@</span>data<span class="op">$</span>FLUR &lt;-<span class="st"> </span><span class="fl">1.17</span></span>
<span id="cb1-238"><a href="#cb1-238"></a></span>
<span id="cb1-239"><a href="#cb1-239"></a><span class="co"># select required columns and write out new shapefile</span></span>
<span id="cb1-240"><a href="#cb1-240"></a>requiredCols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'CODE'</span>, <span class="st">'BEZIRK'</span>, <span class="st">'STAGEB'</span>, <span class="st">'BLOCK'</span>, <span class="st">'TEILBLOCK'</span>,</span>
<span id="cb1-241"><a href="#cb1-241"></a>                  <span class="st">'NUTZUNG'</span>, <span class="st">'TYP'</span>,</span>
<span id="cb1-242"><a href="#cb1-242"></a>                  <span class="st">'FLGES'</span>, <span class="st">'STR_FLGES'</span>,</span>
<span id="cb1-243"><a href="#cb1-243"></a>                  <span class="st">'PROBAU'</span>, <span class="st">'PROVGU'</span>, <span class="st">'VGSTRASSE'</span>,</span>
<span id="cb1-244"><a href="#cb1-244"></a>                  <span class="st">'BELAG1'</span>, <span class="st">'BELAG2'</span>, <span class="st">'BELAG3'</span>, <span class="st">'BELAG4'</span>,</span>
<span id="cb1-245"><a href="#cb1-245"></a>                  <span class="st">'STR_BELAG1'</span>, <span class="st">'STR_BELAG2'</span>, <span class="st">'STR_BELAG3'</span>, <span class="st">'STR_BELAG4'</span>,</span>
<span id="cb1-246"><a href="#cb1-246"></a>                  <span class="st">'KAN_BEB'</span>, <span class="st">'KAN_VGU'</span>, <span class="st">'KAN_STR'</span>,</span>
<span id="cb1-247"><a href="#cb1-247"></a>                  <span class="st">'REGENJA'</span>, <span class="st">'REGENSO'</span>,</span>
<span id="cb1-248"><a href="#cb1-248"></a>                  <span class="st">'FELD_30'</span>, <span class="st">'FELD_150'</span>, <span class="st">'FLUR'</span>)</span>
<span id="cb1-249"><a href="#cb1-249"></a>abimo<span class="op">@</span>data &lt;-<span class="st"> </span>abimo<span class="op">@</span>data[, requiredCols]</span>
<span id="cb1-250"><a href="#cb1-250"></a></span>
<span id="cb1-251"><a href="#cb1-251"></a><span class="co"># format numbers to 0 decimal places</span></span>
<span id="cb1-252"><a href="#cb1-252"></a>abimo<span class="op">@</span>data[, <span class="dv">8</span><span class="op">:</span><span class="kw">ncol</span>(abimo<span class="op">@</span>data)] &lt;-<span class="st"> </span><span class="kw">round</span>(</span>
<span id="cb1-253"><a href="#cb1-253"></a>  abimo<span class="op">@</span>data[, <span class="dv">8</span><span class="op">:</span><span class="kw">ncol</span>(abimo<span class="op">@</span>data)],</span>
<span id="cb1-254"><a href="#cb1-254"></a>  <span class="dt">digits =</span> <span class="dv">0</span>)</span>
<span id="cb1-255"><a href="#cb1-255"></a></span>
<span id="cb1-256"><a href="#cb1-256"></a><span class="co"># change decimal separator to comma (ABIMO does not run correctly otherwise)</span></span>
<span id="cb1-257"><a href="#cb1-257"></a>abimo<span class="op">@</span>data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">apply</span>(<span class="dt">X=</span><span class="kw">apply</span>(<span class="dt">X=</span>abimo<span class="op">@</span>data,</span>
<span id="cb1-258"><a href="#cb1-258"></a>                                         <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb1-259"><a href="#cb1-259"></a>                                         <span class="dt">FUN=</span>as.character),</span>
<span id="cb1-260"><a href="#cb1-260"></a>                                 <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb1-261"><a href="#cb1-261"></a>                                 <span class="dt">FUN=</span>gsub,</span>
<span id="cb1-262"><a href="#cb1-262"></a>                                 <span class="dt">pattern=</span><span class="st">"</span><span class="ch">\\</span><span class="st">."</span>,</span>
<span id="cb1-263"><a href="#cb1-263"></a>                                 <span class="dt">replacement=</span><span class="st">","</span>),</span>
<span id="cb1-264"><a href="#cb1-264"></a>                           <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-265"><a href="#cb1-265"></a></span>
<span id="cb1-266"><a href="#cb1-266"></a><span class="co"># write ABIMO input table</span></span>
<span id="cb1-267"><a href="#cb1-267"></a>abimo_inp &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">'abimo_%s.shp'</span>, paths<span class="op">$</span>site)</span>
<span id="cb1-268"><a href="#cb1-268"></a>abimo_inp_path &lt;-<span class="st"> </span><span class="kw">file.path</span>(paths<span class="op">$</span>abimo, abimo_inp)</span>
<span id="cb1-269"><a href="#cb1-269"></a>raster<span class="op">::</span><span class="kw">shapefile</span>(<span class="dt">x=</span>abimo, </span>
<span id="cb1-270"><a href="#cb1-270"></a>                  <span class="dt">filename=</span>abimo_inp_path,</span>
<span id="cb1-271"><a href="#cb1-271"></a>                  <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</span>
<span id="cb1-272"><a href="#cb1-272"></a></span>
<span id="cb1-273"><a href="#cb1-273"></a></span>
<span id="cb1-274"><a href="#cb1-274"></a><span class="co"># run ABIMO manually in GUI ----------------------------------------------------</span></span>
<span id="cb1-275"><a href="#cb1-275"></a>abimo_out &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">'abimo_%sout.dbf'</span>, paths<span class="op">$</span>site)</span>
<span id="cb1-276"><a href="#cb1-276"></a><span class="cf">if</span>(<span class="op">!</span>fs<span class="op">::</span><span class="kw">file_exists</span>(paths<span class="op">$</span>abimo_exe)) {</span>
<span id="cb1-277"><a href="#cb1-277"></a>  <span class="kw">stop</span>(<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">"ABIMO executale does not exist: %s</span></span>
<span id="cb1-278"><a href="#cb1-278"></a><span class="st">Please copy to this location"</span>, paths<span class="op">$</span>abimo_exe)))</span>
<span id="cb1-279"><a href="#cb1-279"></a>} <span class="cf">else</span> {</span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="kw">message</span>(<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">"Run ABIMO executable manually:</span></span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="st">1. Select input file: </span><span class="ch">\"</span><span class="st">%s</span><span class="ch">\"</span></span>
<span id="cb1-282"><a href="#cb1-282"></a><span class="st">2. Save it under: </span><span class="ch">\"</span><span class="st">%s</span><span class="ch">\"</span><span class="st">"</span>, </span>
<span id="cb1-283"><a href="#cb1-283"></a>                    abimo_inp_path, </span>
<span id="cb1-284"><a href="#cb1-284"></a>                    abimo_out))</span>
<span id="cb1-285"><a href="#cb1-285"></a>)</span>
<span id="cb1-286"><a href="#cb1-286"></a>      </span>
<span id="cb1-287"><a href="#cb1-287"></a>kwb.utils<span class="op">::</span><span class="kw">hsOpenWindowsExplorer</span>(paths<span class="op">$</span>abimo_exe)</span>
<span id="cb1-288"><a href="#cb1-288"></a></span>
<span id="cb1-289"><a href="#cb1-289"></a><span class="co"># postprocessing ----------------------------------------------------------------</span></span>
<span id="cb1-290"><a href="#cb1-290"></a><span class="co"># post-process ABIMO output file -&gt; join it with input shape file for </span></span>
<span id="cb1-291"><a href="#cb1-291"></a><span class="co"># visualization in GIS</span></span>
<span id="cb1-292"><a href="#cb1-292"></a>urbanAnnualRunoff<span class="op">::</span><span class="kw">postProcessABIMO</span>(<span class="dt">rawdir =</span> paths<span class="op">$</span>abimo,</span>
<span id="cb1-293"><a href="#cb1-293"></a>                 <span class="dt">nameABIMOin =</span> abimo_inp,</span>
<span id="cb1-294"><a href="#cb1-294"></a>                 <span class="dt">nameABIMOout =</span> abimo_out,</span>
<span id="cb1-295"><a href="#cb1-295"></a>                 <span class="dt">ABIMOjoinedName =</span> <span class="kw">sprintf</span>(<span class="st">"%s_joined.dbf"</span>, abimo_out)</span>
<span id="cb1-296"><a href="#cb1-296"></a>                )</span>
<span id="cb1-297"><a href="#cb1-297"></a>}</span>
<span id="cb1-298"><a href="#cb1-298"></a></span>
<span id="cb1-299"><a href="#cb1-299"></a><span class="co"># compute emissions Jinxi with OgRe AMC (annual mean concentration) database</span></span>
<span id="cb1-300"><a href="#cb1-300"></a>conc &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">read_concentrations</span>(<span class="dt">path =</span> paths<span class="op">$</span>emissions_input)</span>
<span id="cb1-301"><a href="#cb1-301"></a></span>
<span id="cb1-302"><a href="#cb1-302"></a>abimo_inpout_emissions &lt;-<span class="st"> </span>urbanAnnualRunoff<span class="op">::</span><span class="kw">calculate_loads</span>(</span>
<span id="cb1-303"><a href="#cb1-303"></a>  <span class="dt">abimo_inpout =</span> abimo_inpout, </span>
<span id="cb1-304"><a href="#cb1-304"></a>  <span class="dt">concentrations =</span> conc</span>
<span id="cb1-305"><a href="#cb1-305"></a>  )</span>
<span id="cb1-306"><a href="#cb1-306"></a></span>
<span id="cb1-307"><a href="#cb1-307"></a><span class="co"># write out joined table output as shapefile</span></span>
<span id="cb1-308"><a href="#cb1-308"></a>outFile &lt;-<span class="st"> </span><span class="kw">file.path</span>(paths<span class="op">$</span>emissions_output, </span>
<span id="cb1-309"><a href="#cb1-309"></a>                     <span class="kw">sprintf</span>(<span class="st">"abimo_%s_emissions.shp"</span>, paths<span class="op">$</span>site))</span>
<span id="cb1-310"><a href="#cb1-310"></a>  </span>
<span id="cb1-311"><a href="#cb1-311"></a>raster<span class="op">::</span><span class="kw">shapefile</span>(<span class="dt">x =</span> abimo_inpout_emissions, </span>
<span id="cb1-312"><a href="#cb1-312"></a>                  <span class="dt">filename =</span> outFile, </span>
<span id="cb1-313"><a href="#cb1-313"></a>                  <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-314"><a href="#cb1-314"></a></span>
<span id="cb1-315"><a href="#cb1-315"></a>}</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/robetatis">Roberto Tatis-Muvdi</a>, <a href="https://mrustl.de">Michael Rustler</a>, <a href="https://www.kompetenz-wasser.de/en/project/keys/"><img src="https://www.kompetenz-wasser.de/wp-content/uploads/2018/09/keys-logo.png" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '3b4f8dee7a78052bd10dd954369f2c28',
    indexName: 'urbanAnnualRunoff',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
